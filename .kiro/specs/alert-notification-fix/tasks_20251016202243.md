# Implementation Plan

- [x] 1. Update Bicep template alert configuration
  - Modify the scheduled query rule resource in main.bicep to set `muteActionsDuration: 'PT0M'`
  - Modify the scheduled query rule resource in main.bicep to set `autoMitigate: true`
  - Add inline comments explaining the configuration choices
  - _Requirements: 1.3, 2.1_

- [ ] 2. Enhance deployment script with alert verification
  - [ ] 2.1 Add alert configuration verification section after infrastructure deployment
    - Query the deployed alert rule to retrieve muteActionsDuration and autoMitigate values
    - Compare actual values against expected values (PT0M and true)
    - Display success message if values match, warning message if they don't
    - _Requirements: 5.2, 5.3_
  
  - [ ] 2.2 Add action group configuration display
    - Query the action group to retrieve enabled status and email receiver details
    - Display the configuration in a table format for user verification
    - Include email address and receiver status in the output
    - _Requirements: 3.4, 5.4_
  
  - [ ] 2.3 Update deployment success message
    - Add section explaining alert configuration
    - Include next steps for testing the alert system
    - Provide command to manually verify alert settings
    - _Requirements: 3.1_

- [ ] 3. Update README.md documentation
  - [ ] 3.1 Add Alert Configuration section
    - Explain the alert evaluation frequency and notification behavior
    - Document that emails are sent every 5 minutes during outages
    - Explain auto-resolution behavior when connectivity is restored
    - _Requirements: 6.1, 6.2_
  
  - [ ] 3.2 Add Testing Alerts section
    - Provide step-by-step instructions to manually trigger an alert
    - Include commands to stop and start the heartbeat agent
    - Specify expected wait times (6-7 minutes for evaluation)
    - Include verification commands to check alert status
    - _Requirements: 4.1, 4.2, 4.3, 4.4_
  
  - [ ] 3.3 Add Email Delivery Troubleshooting section
    - List common email delivery issues (spam folder, Gmail tabs)
    - Provide instructions to check spam folders for Azure emails
    - Include steps to add Azure email addresses to safe senders list
    - Document the email confirmation requirement for action groups
    - _Requirements: 3.2, 3.3, 6.3_

- [ ] 4. Update ALERT_TROUBLESHOOTING.md with resolution status
  - Add a Resolution Status section at the top of the document
  - Mark the issue as resolved with date and fix details
  - List the specific changes made (muteActionsDuration and autoMitigate)
  - Reference the updated README.md for testing procedures
  - Keep the original troubleshooting content for reference
  - _Requirements: 6.1, 6.2, 6.4_

- [ ] 5. Create testing validation script
  - [ ] 5.1 Create test_alerts.sh script
    - Add commands to verify alert configuration after deployment
    - Include checks for muteActionsDuration and autoMitigate settings
    - Add action group verification commands
    - Display results in a clear, user-friendly format
    - _Requirements: 4.1, 5.2, 5.3_
  
  - [ ]* 5.2 Add alert history query
    - Include command to query recent alert activity from Azure Monitor
    - Display alert firing and resolution events
    - Show timestamps and alert states
    - _Requirements: 4.3_
